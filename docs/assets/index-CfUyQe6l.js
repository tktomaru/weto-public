const R=new Error("failed to get response body reader"),g=new Error("failed to complete download"),y="Content-Length",E=async(o,e)=>{var d;const r=await fetch(o);let n;try{const t=parseInt(r.headers.get(y)||"-1"),l=(d=r.body)==null?void 0:d.getReader();if(!l)throw R;const i=[];let s=0;for(;;){const{done:a,value:c}=await l.read(),f=c?c.length:0;if(a){if(t!=-1&&t!==s)throw g;e&&e({url:o,total:t,received:s,delta:f,done:a});break}i.push(c),s+=f,e&&e({url:o,total:t,received:s,delta:f,done:a})}const h=new Uint8Array(s);let w=0;for(const a of i)h.set(a,w),w+=a.length;n=h.buffer}catch(t){console.log("failed to send download progress event: ",t),n=await r.arrayBuffer(),e&&e({url:o,total:n.byteLength,received:n.byteLength,delta:0,done:!0})}return n},p=async(o,e,r=!1,n)=>{const d=r?await E(o,n):await(await fetch(o)).arrayBuffer(),t=new Blob([d],{type:e});return URL.createObjectURL(t)};export{E as downloadWithProgress,p as toBlobURL};
